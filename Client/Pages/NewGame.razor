@page "/new-game"
@using System.Security.Cryptography
@using Client.Pages.Components.Wordle
@using Shared
@using Shared.Dtos

@inject HttpClient Http
@inject ILocalStorageService LocalStorage
@inject NavigationManager Navigation

<PageTitle>New game</PageTitle>

<PageTitle>New game</PageTitle>

<div class="container">
    <p>Creating a new game…</p>
</div>

<style>
    .container {
        max-width: 720px;
        margin: 1.5rem auto;
        padding: 1rem;
        font-family: system-ui, -apple-system, "Segoe UI", Roboto;
    }

    header {
        text-align: center;
        margin-bottom: 1rem;
    }

</style>

@code {
    GameDto? Game { get; set; }

    protected override async Task OnInitializedAsync() {
        await GetNewGameAsync();
    }

    async Task GetNewGameAsync() {
        try {
            var token = await LocalStorage.GetItemAsync<string>("authToken");
            Http.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token);

            var response = await Http.PostAsync("/api/games", null);
            response.EnsureSuccessStatusCode();
            var game = await response.Content.ReadFromJsonAsync<GameDto>();
            if (game != null) {
                Navigation.NavigateTo($"/game/{game.Id}");
            }
        }
        catch (Exception ex) {
            Console.WriteLine(ex.Message);
        }
    }
}