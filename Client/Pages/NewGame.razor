@page "/new-game"
@using System.Security.Cryptography
@using Client.Pages.Components.Wordle
@using Shared
@using Shared.Dtos

@inject HttpClient Http
@inject ILocalStorageService LocalStorage

<PageTitle>New game</PageTitle>

<div class="container">
    @if (Game != null) {
        <header>
            <h1>New game</h1>
            <p class="sub">
                Guess the 5-letter word. You have <strong>6</strong> tries.
                @if (Game.Category is not null) {
                    <span> Category: <strong>@Game.Category</strong></span>
                }
            </p>
        </header>

        <main>
            <WordleGame GameDto=@Game />
            <footer>
                <small>Local demo — replace the in-file wordlist with server-driven daily words for production.</small>
            </footer>
        </main>
    }
    else {
        <p>Loading new game...</p>
    }
</div>

<style>
    .container {
        max-width: 720px;
        margin: 1.5rem auto;
        padding: 1rem;
        font-family: system-ui, -apple-system, "Segoe UI", Roboto;
    }

    header {
        text-align: center;
        margin-bottom: 1rem;
    }

</style>

@code {
    GameDto? Game { get; set; }

    protected override async Task OnInitializedAsync() {
        await GetNewGameAsync();
    }

    async Task GetNewGameAsync() {
        try {
            var token = await LocalStorage.GetItemAsync<string>("authToken");
            Http.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token);

            Game = await Http.GetFromJsonAsync<GameDto>("/api/game/new_game");
        }
        catch (Exception ex) {
            Console.WriteLine(ex.Message);
        }
    }
}