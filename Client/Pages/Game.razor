@page "/game/{GameId:int}"

@using System.Security.Cryptography
@using Client.Pages.Components.Wordle
@using Shared
@using Shared.Dtos

@inject HttpClient Http
@inject ILocalStorageService LocalStorage

<PageTitle>Game @GameId</PageTitle>

<div class="container">
    @if (GameItem != null) {
        <header>
            <h1>New game</h1>
            <p class="sub">
                Guess the 5-letter word. You have <strong>6</strong> tries.
                @if (GameItem.Category is not null) {
                    <span> Category: <strong>@GameItem.Category</strong></span>
                }
            </p>
        </header>

        <main>
            <WordleGame GameDto=@GameItem />
        </main>
    }
    else {
        <p>Loading new game...</p>
    }
</div>

<style>
    .container {
        max-width: 720px;
        margin: 1.5rem auto;
        padding: 1rem;
        font-family: system-ui, -apple-system, "Segoe UI", Roboto;
    }

    header {
        text-align: center;
        margin-bottom: 1rem;
    }

</style>

@code {
    [Parameter]
    public int GameId { get; set; }

    GameDto? GameItem { get; set; }

    protected override async Task OnInitializedAsync() {
        await GetGameAsync();
    }

    async Task GetGameAsync() {
        try {
            var token = await LocalStorage.GetItemAsync<string>("authToken");
            Http.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token);
            Http.DefaultRequestHeaders.CacheControl = new CacheControlHeaderValue {
                NoCache = true,
                NoStore = true
            };
            GameItem = await Http.GetFromJsonAsync<GameDto>($"/api/games/{GameId}");
        }
        catch (Exception ex) {
            Console.WriteLine(ex.Message);
        }
    }
}